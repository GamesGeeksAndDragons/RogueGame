using System;
using Assets.Level;
using AssetsTests.Fakes;
using AssetsTests.Helpers;
using Utils;
using Utils.Enums;
using Xunit;
using Xunit.Abstractions;

namespace AssetsTests.ActionTests
{
    public class MoveActionTests : LevelBuilderTestHelpers
    {
        public MoveActionTests(ITestOutputHelper output)
        : base(output)
        {
        }

        internal static string GetExpectation(int testNum)
        {
            switch (testNum)
            {
                case 1:return @"
  |012345678901234567890123456789|  
------------------------------------
0 |██████████████████████████████|0 
1 |██████████████████████████████|1 
2 |██████████████████████████████|2 
3 |██████████████████████████████|3 
4 |██████████████████████████████|4 
5 |██████████████████████████████|5 
6 |██████████████████████████████|6 
7 |██████████████████████████████|7 
8 |██████████████████████████████|8 
9 |██████████████████████████████|9 
10|██████████████████████████████|10
11|██████████████████████████████|11
12|██████████████████████████████|12
13|██████████████████████████████|13
14|██████████████████████████████|14
15|██████████████████████████████|15
16|███████╔════════╗█████████████|16
17|███████║¹¹¹M@¹¹¹║█████████████|17
18|███████║¹¹¹¹¹¹¹¹║█████████████|18
19|███████║¹¹¹¹¹¹¹¹║█████████████|19
20|███████║¹¹¹¹¹¹¹¹║█████████████|20
21|███████║¹¹¹¹¹¹¹¹║█████████████|21
22|███████║¹¹¹¹¹¹¹¹║█████████████|22
23|███████║¹¹¹¹¹¹¹¹║█████████████|23
24|███████║¹¹¹¹¹¹¹¹║█████████████|24
25|███████╚════════╝█████████████|25
26|██████████████████████████████|26
27|██████████████████████████████|27
28|██████████████████████████████|28
29|██████████████████████████████|29
------------------------------------
  |012345678901234567890123456789|  
";
                case 2:return @"
  |012345678901234567890123456789|  
------------------------------------
0 |██████████████████████████████|0 
1 |██████████████████████████████|1 
2 |██████████████████████████████|2 
3 |██████████████████████████████|3 
4 |██████████████████████████████|4 
5 |██████████████████████████████|5 
6 |██████████████████████████████|6 
7 |██████████████████████████████|7 
8 |██████████████████████████████|8 
9 |██████████████████████████████|9 
10|██████████████████████████████|10
11|██████████████████████████████|11
12|██████████████████████████████|12
13|██████████████████████████████|13
14|██████████████████████████████|14
15|██████████████████████████████|15
16|███████╔════════╗█████████████|16
17|███████║¹¹¹M¹¹¹¹║█████████████|17
18|███████║¹¹¹¹¹¹¹¹║█████████████|18
19|███████║¹¹¹¹¹¹¹¹║█████████████|19
20|███████║¹¹¹¹¹¹¹¹║█████████████|20
21|███████║¹¹¹¹¹¹¹¹║█████████████|21
22|███████║¹¹¹¹¹¹¹¹║█████████████|22
23|███████║¹¹¹¹¹¹¹¹║█████████████|23
24|███████║¹¹¹¹@¹¹¹║█████████████|24
25|███████╚════════╝█████████████|25
26|██████████████████████████████|26
27|██████████████████████████████|27
28|██████████████████████████████|28
29|██████████████████████████████|29
------------------------------------
  |012345678901234567890123456789|  
";
                case 3:return @"
  |012345678901234567890123456789|  
------------------------------------
0 |██████████████████████████████|0 
1 |██████████████████████████████|1 
2 |██████████████████████████████|2 
3 |██████████████████████████████|3 
4 |██████████████████████████████|4 
5 |██████████████████████████████|5 
6 |██████████████████████████████|6 
7 |██████████████████████████████|7 
8 |██████████████████████████████|8 
9 |██████████████████████████████|9 
10|██████████████████████████████|10
11|██████████████████████████████|11
12|██████████████████████████████|12
13|██████████████████████████████|13
14|██████████████████████████████|14
15|██████████████████████████████|15
16|███████╔════════╗█████████████|16
17|███████║¹¹¹M¹¹¹¹║█████████████|17
18|███████║¹¹¹¹¹¹¹¹║█████████████|18
19|███████║¹¹¹¹¹¹¹@║█████████████|19
20|███████║¹¹¹¹¹¹¹¹║█████████████|20
21|███████║¹¹¹¹¹¹¹¹║█████████████|21
22|███████║¹¹¹¹¹¹¹¹║█████████████|22
23|███████║¹¹¹¹¹¹¹¹║█████████████|23
24|███████║¹¹¹¹¹¹¹¹║█████████████|24
25|███████╚════════╝█████████████|25
26|██████████████████████████████|26
27|██████████████████████████████|27
28|██████████████████████████████|28
29|██████████████████████████████|29
------------------------------------
  |012345678901234567890123456789|  
";
                case 4: return @"
  |012345678901234567890123456789|  
------------------------------------
0 |██████████████████████████████|0 
1 |██████████████████████████████|1 
2 |██████████████████████████████|2 
3 |██████████████████████████████|3 
4 |██████████████████████████████|4 
5 |██████████████████████████████|5 
6 |██████████████████████████████|6 
7 |██████████████████████████████|7 
8 |██████████████████████████████|8 
9 |██████████████████████████████|9 
10|██████████████████████████████|10
11|██████████████████████████████|11
12|██████████████████████████████|12
13|██████████████████████████████|13
14|██████████████████████████████|14
15|██████████████████████████████|15
16|███████╔════════╗█████████████|16
17|███████║¹¹¹M¹¹¹¹║█████████████|17
18|███████║¹¹¹¹¹¹¹¹║█████████████|18
19|███████║@¹¹¹¹¹¹¹║█████████████|19
20|███████║¹¹¹¹¹¹¹¹║█████████████|20
21|███████║¹¹¹¹¹¹¹¹║█████████████|21
22|███████║¹¹¹¹¹¹¹¹║█████████████|22
23|███████║¹¹¹¹¹¹¹¹║█████████████|23
24|███████║¹¹¹¹¹¹¹¹║█████████████|24
25|███████╚════════╝█████████████|25
26|██████████████████████████████|26
27|██████████████████████████████|27
28|██████████████████████████████|28
29|██████████████████████████████|29
------------------------------------
  |012345678901234567890123456789|  
";
                case 5: return @"
  |012345678901234567890123456789|  
------------------------------------
0 |██████████████████████████████|0 
1 |██████████████████████████████|1 
2 |██████████████████████████████|2 
3 |██████████████████████████████|3 
4 |██████████████████████████████|4 
5 |██████████████████████████████|5 
6 |██████████████████████████████|6 
7 |██████████████████████████████|7 
8 |██████████████████████████████|8 
9 |██████████████████████████████|9 
10|██████████████████████████████|10
11|██████████████████████████████|11
12|██████████████████████████████|12
13|██████████████████████████████|13
14|██████████████████████████████|14
15|██████████████████████████████|15
16|███████╔════════╗█████████████|16
17|███████║¹¹¹M¹¹@¹║█████████████|17
18|███████║¹¹¹¹¹¹¹¹║█████████████|18
19|███████║¹¹¹¹¹¹¹¹║█████████████|19
20|███████║¹¹¹¹¹¹¹¹║█████████████|20
21|███████║¹¹¹¹¹¹¹¹║█████████████|21
22|███████║¹¹¹¹¹¹¹¹║█████████████|22
23|███████║¹¹¹¹¹¹¹¹║█████████████|23
24|███████║¹¹¹¹¹¹¹¹║█████████████|24
25|███████╚════════╝█████████████|25
26|██████████████████████████████|26
27|██████████████████████████████|27
28|██████████████████████████████|28
29|██████████████████████████████|29
------------------------------------
  |012345678901234567890123456789|  
";
                case 6: return @"
  |012345678901234567890123456789|  
------------------------------------
0 |██████████████████████████████|0 
1 |██████████████████████████████|1 
2 |██████████████████████████████|2 
3 |██████████████████████████████|3 
4 |██████████████████████████████|4 
5 |██████████████████████████████|5 
6 |██████████████████████████████|6 
7 |██████████████████████████████|7 
8 |██████████████████████████████|8 
9 |██████████████████████████████|9 
10|██████████████████████████████|10
11|██████████████████████████████|11
12|██████████████████████████████|12
13|██████████████████████████████|13
14|██████████████████████████████|14
15|██████████████████████████████|15
16|███████╔════════╗█████████████|16
17|███████║¹¹¹M¹¹¹¹║█████████████|17
18|███████║¹¹¹¹¹¹¹¹║█████████████|18
19|███████║¹¹¹¹¹¹¹¹║█████████████|19
20|███████║¹¹¹¹¹¹¹¹║█████████████|20
21|███████║¹¹¹¹¹¹¹¹║█████████████|21
22|███████║¹¹¹¹¹¹¹@║█████████████|22
23|███████║¹¹¹¹¹¹¹¹║█████████████|23
24|███████║¹¹¹¹¹¹¹¹║█████████████|24
25|███████╚════════╝█████████████|25
26|██████████████████████████████|26
27|██████████████████████████████|27
28|██████████████████████████████|28
29|██████████████████████████████|29
------------------------------------
  |012345678901234567890123456789|  
";
                case 7: return @"
  |012345678901234567890123456789|  
------------------------------------
0 |██████████████████████████████|0 
1 |██████████████████████████████|1 
2 |██████████████████████████████|2 
3 |██████████████████████████████|3 
4 |██████████████████████████████|4 
5 |██████████████████████████████|5 
6 |██████████████████████████████|6 
7 |██████████████████████████████|7 
8 |██████████████████████████████|8 
9 |██████████████████████████████|9 
10|██████████████████████████████|10
11|██████████████████████████████|11
12|██████████████████████████████|12
13|██████████████████████████████|13
14|██████████████████████████████|14
15|██████████████████████████████|15
16|███████╔════════╗█████████████|16
17|███████║¹¹@M¹¹¹¹║█████████████|17
18|███████║¹¹¹¹¹¹¹¹║█████████████|18
19|███████║¹¹¹¹¹¹¹¹║█████████████|19
20|███████║¹¹¹¹¹¹¹¹║█████████████|20
21|███████║¹¹¹¹¹¹¹¹║█████████████|21
22|███████║¹¹¹¹¹¹¹¹║█████████████|22
23|███████║¹¹¹¹¹¹¹¹║█████████████|23
24|███████║¹¹¹¹¹¹¹¹║█████████████|24
25|███████╚════════╝█████████████|25
26|██████████████████████████████|26
27|██████████████████████████████|27
28|██████████████████████████████|28
29|██████████████████████████████|29
------------------------------------
  |012345678901234567890123456789|  
";

                default: throw new ArgumentException($"Didn't have Generator for [{testNum}]");
            }
        }

        private void Move_Me_Test(int testNum, params Compass8Points[] directions)
        {
            var gameLevel = Arrange();

            Dispatcher.Dispatch();

            var expected = GetExpectation(testNum).Trim(CharHelpers.EndOfLine);
            AssertTest(gameLevel, expected);

            GameLevel Arrange()
            {
                DieBuilder = new FakeDieBuilder(1, 1);
                ArrangeTest();

                var level = LevelBuilder.BuildNewGame();
                level.Dispatcher.Dispatch();

                var start = level.Print(DispatchRegistry);
                Output.WriteLine(BuilderTestHelpers.Divider + " start " + BuilderTestHelpers.Divider);
                Output.WriteLine(start);

                foreach (var direction in directions)
                {
                    Dispatcher.EnqueueMove(level, level.Me, direction);
                }

                return level;
            }
        }

        [Fact]
        public void Move_MeNorth_WillNotLeaveATrail()
        {
            Move_Me_Test(1, Compass8Points.North, Compass8Points.North, Compass8Points.North, Compass8Points.North, Compass8Points.North);
        }

        [Fact]
        public void Move_MeSouth_WillNotLeaveATrail()
        {
            Move_Me_Test(2, Compass8Points.South, Compass8Points.South, Compass8Points.South, Compass8Points.South, Compass8Points.South);
        }

        [Fact]
        public void Move_MeEast_WillNotLeaveATrail()
        {
            Move_Me_Test(3, Compass8Points.East, Compass8Points.East, Compass8Points.East, Compass8Points.East, Compass8Points.East, Compass8Points.East);
        }

        [Fact]
        public void Move_MeWest_WillNotLeaveATrail()
        {
            Move_Me_Test(4, Compass8Points.West, Compass8Points.West, Compass8Points.West, Compass8Points.West, Compass8Points.West, Compass8Points.West);
        }

        [Fact]
        public void Move_MeNorthEast_WillNotLeaveATrail()
        {
            Move_Me_Test(5, Compass8Points.NorthEast, Compass8Points.NorthEast, Compass8Points.NorthEast, Compass8Points.NorthEast, Compass8Points.NorthEast, Compass8Points.NorthEast);
        }

        [Fact]
        public void Move_MeSouthEast_WillNotLeaveATrail()
        {
            Move_Me_Test(6, Compass8Points.SouthEast, Compass8Points.SouthEast, Compass8Points.SouthEast, Compass8Points.SouthEast, Compass8Points.SouthEast, Compass8Points.SouthEast);
        }

        [Fact]
        public void Move_Me_AroundCharacterWillNotWalkThoughIt()
        {
            Move_Me_Test(7, Compass8Points.North, Compass8Points.North, Compass8Points.West, Compass8Points.SouthWest, Compass8Points.North, Compass8Points.NorthWest, Compass8Points.East);
        }
    }
}
